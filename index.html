<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weight & Calories Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f9f9f9;
        }
        h1, h2 {
            text-align: center;
        }
        .calendar-nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        input, button {
            margin: 5px 0;
            padding: 10px;
            font-size: 16px;
        }
        #graph {
            margin-top: 30px;
            height: 300px;
        }
    </style>
</head>
<body>

    <h1>Weight & Calories Tracker</h1>
    <div class="calendar-nav">
        <button id="prevDay">⬅️ Prev</button>
        <h2 id="currentDate"></h2>
        <button id="nextDay">Next ➡️</button>
    </div>

    <label for="weight">Weight (kg):</label>
    <input type="number" id="weight" placeholder="Enter weight">
    <button id="saveWeight">Save Weight</button>

    <label for="calories">Calories:</label>
    <input type="number" id="calories" placeholder="Enter calories">
    <button id="saveCalories">Save Calories</button>

    <canvas id="graph"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const dateDisplay = document.getElementById('currentDate');
        let currentDate = new Date();
        let data = JSON.parse(localStorage.getItem('trackerData')) || {};

        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function updateDateDisplay() {
            dateDisplay.textContent = currentDate.toDateString();
            loadDayData();
        }

        document.getElementById('prevDay').addEventListener('click', () => {
            currentDate.setDate(currentDate.getDate() - 1);
            updateDateDisplay();
        });

        document.getElementById('nextDay').addEventListener('click', () => {
            currentDate.setDate(currentDate.getDate() + 1);
            updateDateDisplay();
        });

        document.getElementById('saveWeight').addEventListener('click', () => {
            const weight = parseFloat(document.getElementById('weight').value);
            if (!isNaN(weight)) {
                const dateKey = formatDate(currentDate);
                data[dateKey] = data[dateKey] || {};
                data[dateKey].weight = weight;
                localStorage.setItem('trackerData', JSON.stringify(data));
                loadGraph();
            }
        });

        document.getElementById('saveCalories').addEventListener('click', () => {
            const calories = parseInt(document.getElementById('calories').value);
            if (!isNaN(calories)) {
                const dateKey = formatDate(currentDate);
                data[dateKey] = data[dateKey] || {};
                data[dateKey].calories = calories;
                localStorage.setItem('trackerData', JSON.stringify(data));
            }
        });

        function loadDayData() {
            const dateKey = formatDate(currentDate);
            document.getElementById('weight').value = data[dateKey]?.weight || '';
            document.getElementById('calories').value = data[dateKey]?.calories || '';
        }

        function loadGraph() {
            const sortedDates = Object.keys(data).sort();
            const weights = sortedDates.map(date => data[date].weight || null);
            const colors = sortedDates.map((date, index) => {
                if (data[date].weight != null) {
                    const pastWeekWeights = sortedDates
                        .slice(Math.max(0, index - 7), index)
                        .map(d => data[d].weight)
                        .filter(w => w != null);

                    if (pastWeekWeights.length > 0) {
                        const avg = pastWeekWeights.reduce((a, b) => a + b, 0) / pastWeekWeights.length;
                        return data[date].weight < avg ? 'green' : 'red';
                    }
                }
                return 'gray';
            });

            const ctx = document.getElementById('graph').getContext('2d');
            if (window.weightChart) {
                window.weightChart.destroy();
            }
            window.weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedDates,
                    datasets: [{
                        label: 'Weight (kg)',
                        data: weights,
                        borderColor: 'blue',
                        backgroundColor: colors,
                        pointBackgroundColor: colors,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: true } }
                }
            });
        }

        updateDateDisplay();
        loadGraph();
    </script>

</body>
</html>
