<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>My Offline Tracker</title>

<!-- PWA manifest -->
<link rel="manifest" href="manifest.json" />

<style>
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
         Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
         max-width: 600px; margin: auto; padding: 1rem; background: #fafafa; }
  h1 { text-align: center; }
  section { margin-bottom: 2rem; }
  input, button { padding: 0.5rem; font-size: 1rem; }
  ul { list-style: none; padding-left: 0; }
  li { background: white; margin: 0.25rem 0; padding: 0.5rem; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; }
  button.done { background-color: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer; }
  button.delete { background-color: #e53935; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 0.5rem; }
</style>
</head>
<body>

<h1>My Offline Tracker</h1>

<section id="calories-section">
  <h2>Calories</h2>
  <form id="calorie-form">
    <input type="text" id="calorie-item" placeholder="Food item" required />
    <input type="number" id="calorie-value" placeholder="Calories" required min="0" />
    <button type="submit">Add</button>
  </form>
  <ul id="calorie-list"></ul>
</section>

<section id="habits-section">
  <h2>Habits</h2>
  <form id="habit-form">
    <input type="text" id="habit-name" placeholder="Habit name" required />
    <button type="submit">Add</button>
  </form>
  <ul id="habit-list"></ul>
</section>

<section id="todo-section">
  <h2>To-Do</h2>
  <form id="todo-form">
    <input type="text" id="todo-task" placeholder="Task" required />
    <button type="submit">Add</button>
  </form>
  <ul id="todo-list"></ul>
</section>

<script>
  // Storage keys
  const STORAGE_KEYS = {
    calories: 'offlineTrackerCalories',
    habits: 'offlineTrackerHabits',
    todos: 'offlineTrackerTodos',
  };

  // Load saved data or empty array
  let calories = JSON.parse(localStorage.getItem(STORAGE_KEYS.calories)) || [];
  let habits = JSON.parse(localStorage.getItem(STORAGE_KEYS.habits)) || [];
  let todos = JSON.parse(localStorage.getItem(STORAGE_KEYS.todos)) || [];

  // Save to localStorage helper
  function saveData() {
    localStorage.setItem(STORAGE_KEYS.calories, JSON.stringify(calories));
    localStorage.setItem(STORAGE_KEYS.habits, JSON.stringify(habits));
    localStorage.setItem(STORAGE_KEYS.todos, JSON.stringify(todos));
  }

  // Render lists
  function renderCalories() {
    const list = document.getElementById('calorie-list');
    list.innerHTML = '';
    calories.forEach((c, i) => {
      const li = document.createElement('li');
      li.textContent = `${c.item} - ${c.calories} cal`;
      const btn = document.createElement('button');
      btn.textContent = 'Delete';
      btn.className = 'delete';
      btn.onclick = () => {
        calories.splice(i, 1);
        saveData();
        renderCalories();
      };
      li.appendChild(btn);
      list.appendChild(li);
    });
  }

  function renderHabits() {
    const list = document.getElementById('habit-list');
    list.innerHTML = '';
    habits.forEach((h, i) => {
      const li = document.createElement('li');
      li.textContent = h.name + (h.done ? ' ✅' : '');
      const doneBtn = document.createElement('button');
      doneBtn.textContent = h.done ? 'Undo' : 'Done';
      doneBtn.className = 'done';
      doneBtn.onclick = () => {
        habits[i].done = !habits[i].done;
        saveData();
        renderHabits();
      };
      const delBtn = document.createElement('button');
      delBtn.textContent = 'Delete';
      delBtn.className = 'delete';
      delBtn.onclick = () => {
        habits.splice(i, 1);
        saveData();
        renderHabits();
      };
      li.appendChild(doneBtn);
      li.appendChild(delBtn);
      list.appendChild(li);
    });
  }

  function renderTodos() {
    const list = document.getElementById('todo-list');
    list.innerHTML = '';
    todos.forEach((t, i) => {
      const li = document.createElement('li');
      li.textContent = t.task + (t.done ? ' ✅' : '');
      const doneBtn = document.createElement('button');
      doneBtn.textContent = t.done ? 'Undo' : 'Done';
      doneBtn.className = 'done';
      doneBtn.onclick = () => {
        todos[i].done = !todos[i].done;
        saveData();
        renderTodos();
      };
      const delBtn = document.createElement('button');
      delBtn.textContent = 'Delete';
      delBtn.className = 'delete';
      delBtn.onclick = () => {
        todos.splice(i, 1);
        saveData();
        renderTodos();
      };
      li.appendChild(doneBtn);
      li.appendChild(delBtn);
      list.appendChild(li);
    });
  }

  // Handle form submissions
  document.getElementById('calorie-form').onsubmit = e => {
    e.preventDefault();
    const item = document.getElementById('calorie-item').value.trim();
    const caloriesVal = Number(document.getElementById('calorie-value').value);
    if (!item || caloriesVal < 0) return;
    calories.push({item, calories: caloriesVal});
    saveData();
    renderCalories();
    e.target.reset();
  };

  document.getElementById('habit-form').onsubmit = e => {
    e.preventDefault();
    const name = document.getElementById('habit-name').value.trim();
    if (!name) return;
    habits.push({name, done: false});
    saveData();
    renderHabits();
    e.target.reset();
  };

  document.getElementById('todo-form').onsubmit = e => {
    e.preventDefault();
    const task = document.getElementById('todo-task').value.trim();
    if (!task) return;
    todos.push({task, done: false});
    saveData();
    renderTodos();
    e.target.reset();
  };

  // Initial render
  renderCalories();
  renderHabits();
  renderTodos();

  // Register service worker for offline
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
      .then(() => console.log('Service Worker Registered'))
      .catch(err => console.log('Service Worker registration failed:', err));
  }
</script>
</body>
</html>
